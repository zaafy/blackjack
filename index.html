<!DOCTYPE html>
<html>
<head>
	<script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
	<script>
	function begin(playerName){
		// PO KLIKNIECIU ZMIENIC IKONKE NA POWTORZENIE - onclick() ODSWIEZYC STRONE zeby mozna bylo powtorzyc i wymazac wyniki.
		if (typeof playerName == 'undefined') {
		    var playerName = "player";
		}
		while (playerName.toLowerCase() == "player" || playerName == ""){
			playerName = prompt("Please write Your name:");
		};
		startGame(playerName);
	};

	function startGame(playerName){
		var pointsPlayer = 0;
		pointsPlayer += dealCard();
		pointsPlayer += dealCard();
		if (pointsPlayer == 22) {
			endOfGame(playerName + " by double ace", playerName, pointsPlayer);
		}
		var agree = false;
		do{
			if (pointsPlayer > 21) {
				alert("You lost due to too much points (maximum should be 21 points).");
				endOfGame("NPC", playerName, "");
			}
			agree = confirm("Your score is: " + pointsPlayer + ". Do You want another card?");
			if (agree == true){
				pointsPlayer += dealCard();
			} else {
				break;
			}
		}while(true);
		if (pointsPlayer > 21) {
			alert("You lost due to too much points (maximum should be 21 points).");
			endOfGame("NPC", playerName, "");
		} else {
			npcDraws(playerName, pointsPlayer);
		}
	};

	function dealCard(){
		var cards = [2,2,3,3,4,4,5,6,7,8,9,10,11];
		number = Math.floor((Math.random() * 13) + 0);
		return cards[number];
	};

	function npcDraws(playerName, pointsPlayer){
		var pointsNPC = 0;
		pointsNPC += dealCard();
		pointsNPC += dealCard();
		if (pointsNPC == 22) {
			endOfGame("NPC by double ace", playerName, pointsNPC);
		}
		var agree = false;
		do{
			if (pointsNPC > 21) {
				alert("NPC had more points than 21.");
				endOfGame(playerName, playerName, pointsPlayer);
			}
			if (pointsNPC <= pointsPlayer && pointsNPC < 20) agree = true;
			else agree = false;
			if (agree == true){
				pointsNPC += dealCard();
			} else {
				break;
			}
		}while(true);
		if (pointsNPC > 21) {
			alert("NPC had more points than 21.");
			endOfGame(playerName, playerName, pointsPlayer);
		} else if(pointsNPC > pointsPlayer){
			 endOfGame("NPC", playerName, pointsNPC);
		} else {
			endOfGame(playerName, playerName, pointsPlayer);
		}
	};

	function endOfGame(who, playerName, points){
		alert(who + " wins the game with " + points + " points!");
		console.log("dodano punkt dla" + who +  addPoints(who, playerName));
		if (confirm("Would You want to play again?")) begin(playerName);
		else alert("Thanks for playing!");
		exit();
	};

	function addPoints(who, playerName){
		if (who == playerName || who == playerName + " by double ace") {
			//var score = parseInt(document.getElementById('scorePlayer').innerHTML) + 1;
			document.getElementById('scorePlayer').innerHTML = parseInt(document.getElementById('scorePlayer').innerHTML) + 1;
		} else {
			//var score = parseInt(document.getElementById('scoreNPC').innerHTML) + 1;
			document.getElementById('scoreNPC').innerHTML = parseInt(document.getElementById('scoreNPC').innerHTML) + 1;
		}
		return true;
	}

	function exit( status ) {
	    var i;

	    if (typeof status === 'string') {
	        alert(status);
	    }

	    window.addEventListener('error', function (e) {e.preventDefault();e.stopPropagation();}, false);

	    var handlers = [
	        'copy', 'cut', 'paste',
	        'beforeunload', 'blur', 'change', 'click', 'contextmenu', 'dblclick', 'focus', 'keydown', 'keypress', 'keyup', 'mousedown', 'mousemove', 'mouseout', 'mouseover', 'mouseup', 'resize', 'scroll',
	        'DOMNodeInserted', 'DOMNodeRemoved', 'DOMNodeRemovedFromDocument', 'DOMNodeInsertedIntoDocument', 'DOMAttrModified', 'DOMCharacterDataModified', 'DOMElementNameChanged', 'DOMAttributeNameChanged', 'DOMActivate', 'DOMFocusIn', 'DOMFocusOut', 'online', 'offline', 'textInput',
	        'abort', 'close', 'dragdrop', 'load', 'paint', 'reset', 'select', 'submit', 'unload'
	    ];

	    function stopPropagation (e) {
	        e.stopPropagation();
	        // e.preventDefault(); // Stop for the form controls, etc., too?
	    }
	    for (i=0; i < handlers.length; i++) {
	        window.addEventListener(handlers[i], function (e) {stopPropagation(e);}, true);
	    }

	    if (window.stop) {
	        window.stop();
	    }

	    throw '';
	}

	</script>
	<style type="text/css">
		body{
			font-family: open sans;
			background: #ddd;
		}
		a{
			text-decoration: none;
			color:black;
			text-align: center;
			display:inline-block;
		}
		#play{
			font-size:3rem;
		}
		h1, h2{
			text-align: center;
		}
		#scoreboardContainer{
			text-align: center;
		}
		table, td, tr{
			margin:auto;
			padding:10px;
			border:1px solid #777;
			border-collapse: collapse;
		}
	</style>
</head>
<body>

	<h1> Want to play some BlackJack? </h1>
	<h2> Just press play! </h2>
	<p style="text-align:center;">
		<a href="#!" id="play" onclick="begin();"> 
		<i class="fas fa-play"></i>
		</a>
	</p>
	<div id="scoreboardContainer">
		<table id="scoreboard">
			<tr>
				<td id="textScoreboard">
					Player:
				</td>
				<td id="textScoreboard">
					NPC:
				</td>
			</tr>
			<tr>
				<td id="scorePlayer">
					0
				</td>
				<td id="scoreNPC">
					0
				</td>
			</tr>
		</table>
	</div>

</body>
</html>